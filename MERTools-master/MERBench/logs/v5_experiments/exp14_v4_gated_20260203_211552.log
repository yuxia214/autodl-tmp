====== Params Pre-analysis =======
args:  Namespace(audio_feature='chinese-hubert-large-UTT', batch_size=32, contrastive_temperature=0.07, contrastive_weight=0.1, cross_kl_weight=0.01, dataset='MER2023', debug=False, dropout=0.35, e2e_dim=None, e2e_name=None, early_stopping_patience=30, epochs=100, feat_scale=1, feat_type='utt', focal_gamma=2.0, fusion_temperature=1.0, gate_alpha=0.5, gpu=0, grad_clip=1.0, hidden_dim=128, hyper_path=None, kl_warmup_epochs=20, kl_weight=0.01, l2=5e-05, label_smoothing=0.1, lr=0.0005, lr_adjust='case1', lr_factor=0.5, lr_patience=10, mixup_alpha=0.4, modality_dropout=0.15, modality_dropout_warmup=20, model='attention_robust_v4', n_classes=None, num_attention_heads=4, num_workers=0, print_iters=100000000.0, recon_weight=0.1, save_iters=100000000.0, save_root='./saved-trimodal', savemodel=False, test_dataset=None, text_feature='Baichuan-13B-Base-UTT', train_dataset=None, use_contrastive=False, use_dynamic_kl=True, use_gated_fusion=True, use_mixup=False, use_modality_dropout=True, use_proxy_attention=True, use_vae=True, video_feature='clip-vit-large-patch14-UTT')
====== Reading Data =======
train: sample number 3373
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/3373 [00:00<?, ?it/s]  3%|▎         | 97/3373 [00:00<00:09, 333.65it/s]  7%|▋         | 232/3373 [00:00<00:04, 660.64it/s] 10%|█         | 339/3373 [00:00<00:03, 786.99it/s] 13%|█▎        | 437/3373 [00:00<00:03, 830.24it/s] 16%|█▌        | 533/3373 [00:00<00:05, 543.27it/s] 18%|█▊        | 611/3373 [00:01<00:04, 593.19it/s] 21%|██        | 716/3373 [00:01<00:03, 699.28it/s] 24%|██▎       | 801/3373 [00:01<00:05, 491.45it/s] 26%|██▌       | 875/3373 [00:01<00:04, 539.21it/s] 28%|██▊       | 944/3373 [00:01<00:05, 469.02it/s] 32%|███▏      | 1092/3373 [00:01<00:03, 571.66it/s] 36%|███▌      | 1198/3373 [00:01<00:03, 667.58it/s] 39%|███▊      | 1305/3373 [00:02<00:02, 754.80it/s] 41%|████      | 1391/3373 [00:02<00:02, 768.34it/s] 46%|████▌     | 1540/3373 [00:02<00:01, 949.43it/s] 49%|████▊     | 1644/3373 [00:02<00:01, 970.59it/s] 52%|█████▏    | 1749/3373 [00:02<00:01, 990.85it/s] 55%|█████▍    | 1854/3373 [00:02<00:01, 1004.84it/s] 58%|█████▊    | 1971/3373 [00:02<00:01, 1051.51it/s] 62%|██████▏   | 2079/3373 [00:02<00:01, 1055.37it/s] 65%|██████▌   | 2198/3373 [00:02<00:01, 1093.02it/s] 68%|██████▊   | 2309/3373 [00:03<00:01, 854.28it/s]  72%|███████▏  | 2435/3373 [00:03<00:00, 954.06it/s] 76%|███████▌  | 2552/3373 [00:03<00:00, 1009.86it/s] 80%|███████▉  | 2684/3373 [00:03<00:00, 1092.90it/s] 84%|████████▍ | 2840/3373 [00:03<00:00, 1222.87it/s] 88%|████████▊ | 2968/3373 [00:03<00:00, 981.67it/s]  91%|█████████▏| 3078/3373 [00:03<00:00, 989.22it/s] 97%|█████████▋| 3287/3373 [00:03<00:00, 1034.04it/s]100%|██████████| 3373/3373 [00:03<00:00, 844.13it/s] 
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/3373 [00:00<?, ?it/s]  2%|▏         | 57/3373 [00:00<00:05, 569.89it/s]  3%|▎         | 114/3373 [00:00<00:05, 565.29it/s]  5%|▌         | 171/3373 [00:00<00:08, 390.67it/s]  6%|▋         | 215/3373 [00:00<00:07, 404.30it/s]  9%|▊         | 292/3373 [00:00<00:05, 515.58it/s] 11%|█▏        | 386/3373 [00:00<00:04, 642.88it/s] 14%|█▎        | 461/3373 [00:00<00:04, 674.68it/s] 16%|█▌        | 532/3373 [00:01<00:05, 526.69it/s] 18%|█▊        | 595/3373 [00:01<00:05, 551.45it/s] 20%|█▉        | 667/3373 [00:01<00:04, 595.23it/s] 22%|██▏       | 731/3373 [00:01<00:05, 486.71it/s] 24%|██▎       | 793/3373 [00:01<00:04, 518.22it/s] 25%|██▌       | 852/3373 [00:01<00:04, 536.18it/s] 27%|██▋       | 910/3373 [00:01<00:04, 546.13it/s] 29%|██▊       | 968/3373 [00:01<00:05, 437.53it/s] 30%|███       | 1017/3373 [00:02<00:05, 443.36it/s] 32%|███▏      | 1077/3373 [00:02<00:05, 393.05it/s] 33%|███▎      | 1121/3373 [00:02<00:05, 402.25it/s] 35%|███▍      | 1165/3373 [00:02<00:05, 411.14it/s] 36%|███▌      | 1219/3373 [00:02<00:04, 443.99it/s] 38%|███▊      | 1266/3373 [00:02<00:04, 443.11it/s] 40%|████      | 1353/3373 [00:02<00:03, 559.84it/s] 42%|████▏     | 1412/3373 [00:02<00:03, 563.79it/s] 44%|████▎     | 1470/3373 [00:02<00:04, 450.73it/s] 46%|████▌     | 1537/3373 [00:03<00:03, 504.16it/s] 47%|████▋     | 1592/3373 [00:03<00:04, 409.17it/s] 49%|████▊     | 1639/3373 [00:03<00:05, 292.51it/s] 52%|█████▏    | 1741/3373 [00:03<00:03, 425.32it/s] 54%|█████▍    | 1823/3373 [00:03<00:03, 506.69it/s] 56%|█████▌    | 1888/3373 [00:03<00:02, 536.16it/s] 58%|█████▊    | 1952/3373 [00:04<00:03, 378.70it/s] 59%|█████▉    | 2004/3373 [00:04<00:03, 399.61it/s] 61%|██████▏   | 2066/3373 [00:04<00:02, 445.60it/s] 63%|██████▎   | 2120/3373 [00:04<00:02, 466.06it/s] 64%|██████▍   | 2174/3373 [00:04<00:03, 391.40it/s] 66%|██████▌   | 2229/3373 [00:04<00:02, 425.47it/s] 68%|██████▊   | 2282/3373 [00:04<00:02, 450.33it/s] 69%|██████▉   | 2332/3373 [00:05<00:02, 461.68it/s] 71%|███████   | 2395/3373 [00:05<00:01, 506.37it/s] 73%|███████▎  | 2452/3373 [00:05<00:01, 522.54it/s] 75%|███████▍  | 2513/3373 [00:05<00:01, 547.15it/s] 76%|███████▋  | 2578/3373 [00:05<00:01, 459.16it/s] 79%|███████▉  | 2667/3373 [00:05<00:01, 560.80it/s] 81%|████████  | 2728/3373 [00:05<00:01, 567.95it/s] 83%|████████▎ | 2811/3373 [00:05<00:00, 638.16it/s] 85%|████████▌ | 2878/3373 [00:05<00:00, 644.97it/s] 87%|████████▋ | 2945/3373 [00:06<00:00, 647.59it/s] 89%|████████▉ | 3012/3373 [00:06<00:00, 516.08it/s] 91%|█████████ | 3069/3373 [00:06<00:00, 427.22it/s] 94%|█████████▍| 3177/3373 [00:06<00:00, 570.10it/s] 96%|█████████▌| 3246/3373 [00:06<00:00, 596.11it/s] 99%|█████████▉| 3332/3373 [00:06<00:00, 661.96it/s]100%|██████████| 3373/3373 [00:06<00:00, 503.20it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/3373 [00:00<?, ?it/s]  0%|          | 4/3373 [00:00<02:43, 20.59it/s]  1%|          | 36/3373 [00:00<00:22, 147.19it/s]  4%|▍         | 136/3373 [00:00<00:06, 466.96it/s]  6%|▌         | 192/3373 [00:00<00:08, 375.28it/s]  7%|▋         | 238/3373 [00:00<00:07, 397.70it/s] 10%|▉         | 333/3373 [00:00<00:05, 547.27it/s] 12%|█▏        | 395/3373 [00:01<00:08, 362.25it/s] 15%|█▍        | 497/3373 [00:01<00:05, 497.26it/s] 18%|█▊        | 596/3373 [00:01<00:04, 608.30it/s] 20%|██        | 680/3373 [00:01<00:04, 660.83it/s] 22%|██▏       | 758/3373 [00:01<00:04, 550.26it/s] 25%|██▌       | 852/3373 [00:01<00:03, 638.39it/s] 27%|██▋       | 927/3373 [00:01<00:04, 539.75it/s] 29%|██▉       | 991/3373 [00:02<00:05, 452.98it/s] 31%|███       | 1049/3373 [00:02<00:05, 403.27it/s] 33%|███▎      | 1099/3373 [00:02<00:05, 420.35it/s] 35%|███▌      | 1190/3373 [00:02<00:04, 525.85it/s] 37%|███▋      | 1251/3373 [00:02<00:05, 374.22it/s] 39%|███▊      | 1300/3373 [00:02<00:06, 329.60it/s] 41%|████▏     | 1394/3373 [00:03<00:05, 377.60it/s] 43%|████▎     | 1458/3373 [00:03<00:04, 418.92it/s] 45%|████▌     | 1533/3373 [00:03<00:04, 410.05it/s] 47%|████▋     | 1585/3373 [00:03<00:04, 428.05it/s] 48%|████▊     | 1632/3373 [00:03<00:04, 360.11it/s] 50%|████▉     | 1684/3373 [00:03<00:04, 389.12it/s] 53%|█████▎    | 1777/3373 [00:03<00:03, 509.63it/s] 54%|█████▍    | 1835/3373 [00:04<00:04, 308.13it/s] 58%|█████▊    | 1950/3373 [00:04<00:03, 450.00it/s] 60%|█████▉    | 2016/3373 [00:04<00:02, 488.69it/s] 62%|██████▏   | 2082/3373 [00:04<00:02, 434.14it/s] 63%|██████▎   | 2138/3373 [00:04<00:02, 456.35it/s] 65%|██████▌   | 2194/3373 [00:05<00:02, 393.38it/s] 66%|██████▋   | 2242/3373 [00:05<00:02, 406.11it/s] 68%|██████▊   | 2289/3373 [00:05<00:03, 347.42it/s] 69%|██████▉   | 2329/3373 [00:05<00:03, 296.16it/s] 71%|███████▏  | 2407/3373 [00:05<00:02, 389.77it/s] 73%|███████▎  | 2454/3373 [00:05<00:02, 336.09it/s] 75%|███████▍  | 2526/3373 [00:05<00:02, 415.10it/s] 77%|███████▋  | 2591/3373 [00:06<00:02, 377.26it/s] 79%|███████▉  | 2679/3373 [00:06<00:01, 479.82it/s] 81%|████████  | 2736/3373 [00:06<00:01, 408.89it/s] 84%|████████▍ | 2829/3373 [00:06<00:01, 433.48it/s] 85%|████████▌ | 2878/3373 [00:06<00:01, 434.98it/s] 87%|████████▋ | 2926/3373 [00:06<00:01, 372.12it/s] 88%|████████▊ | 2967/3373 [00:07<00:01, 375.95it/s] 90%|████████▉ | 3023/3373 [00:07<00:01, 344.09it/s] 93%|█████████▎| 3129/3373 [00:07<00:00, 407.99it/s] 95%|█████████▍| 3203/3373 [00:07<00:00, 392.82it/s] 99%|█████████▉| 3343/3373 [00:07<00:00, 582.52it/s]100%|██████████| 3373/3373 [00:07<00:00, 432.58it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
test1: sample number 411
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/411 [00:00<?, ?it/s]  0%|          | 1/411 [00:00<02:00,  3.39it/s] 16%|█▌        | 65/411 [00:00<00:02, 159.50it/s] 50%|████▉     | 204/411 [00:00<00:00, 470.12it/s] 67%|██████▋   | 274/411 [00:00<00:00, 428.45it/s] 97%|█████████▋| 399/411 [00:00<00:00, 621.53it/s]100%|██████████| 411/411 [00:00<00:00, 458.99it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/411 [00:00<?, ?it/s]  0%|          | 1/411 [00:00<01:21,  5.05it/s] 12%|█▏        | 49/411 [00:00<00:02, 140.60it/s] 31%|███       | 127/411 [00:00<00:00, 326.69it/s] 54%|█████▍    | 223/411 [00:00<00:00, 512.18it/s] 76%|███████▌  | 312/411 [00:00<00:00, 619.00it/s] 95%|█████████▌| 391/411 [00:00<00:00, 526.62it/s]100%|██████████| 411/411 [00:00<00:00, 454.30it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/411 [00:00<?, ?it/s] 36%|███▋      | 150/411 [00:00<00:00, 1497.51it/s] 74%|███████▍  | 305/411 [00:00<00:00, 1520.83it/s]100%|██████████| 411/411 [00:00<00:00, 1397.75it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
test2: sample number 412
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/412 [00:00<?, ?it/s] 20%|██        | 83/412 [00:00<00:00, 829.81it/s] 61%|██████    | 251/412 [00:00<00:00, 874.64it/s]100%|██████████| 412/412 [00:00<00:00, 1376.08it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/412 [00:00<?, ?it/s]  6%|▋         | 26/412 [00:00<00:01, 256.36it/s] 23%|██▎       | 93/412 [00:00<00:00, 322.91it/s] 38%|███▊      | 158/412 [00:00<00:00, 436.76it/s] 64%|██████▍   | 263/412 [00:00<00:00, 640.64it/s] 81%|████████  | 333/412 [00:00<00:00, 485.81it/s]100%|██████████| 412/412 [00:00<00:00, 516.57it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/412 [00:00<?, ?it/s]  1%|          | 3/412 [00:00<00:13, 29.94it/s] 45%|████▌     | 186/412 [00:00<00:00, 705.36it/s] 59%|█████▉    | 244/412 [00:00<00:00, 648.17it/s] 85%|████████▍ | 350/412 [00:00<00:00, 597.84it/s]100%|██████████| 412/412 [00:00<00:00, 594.84it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
test3: sample number 834
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/834 [00:00<?, ?it/s]  0%|          | 1/834 [00:00<01:24,  9.83it/s] 10%|▉         | 82/834 [00:00<00:01, 476.35it/s] 17%|█▋        | 142/834 [00:00<00:01, 374.63it/s] 26%|██▋       | 220/834 [00:00<00:01, 500.80it/s] 37%|███▋      | 308/834 [00:00<00:00, 615.89it/s] 46%|████▌     | 381/834 [00:00<00:00, 647.46it/s] 56%|█████▌    | 464/834 [00:00<00:00, 700.61it/s] 71%|███████   | 591/834 [00:00<00:00, 871.65it/s] 84%|████████▍ | 701/834 [00:01<00:00, 934.66it/s]100%|██████████| 834/834 [00:01<00:00, 758.39it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/834 [00:00<?, ?it/s]  3%|▎         | 23/834 [00:00<00:03, 229.33it/s]  6%|▌         | 46/834 [00:00<00:03, 222.59it/s] 13%|█▎        | 107/834 [00:00<00:02, 284.39it/s] 23%|██▎       | 193/834 [00:00<00:01, 465.66it/s] 31%|███▏      | 262/834 [00:00<00:01, 535.18it/s] 39%|███▉      | 328/834 [00:00<00:00, 567.97it/s] 51%|█████     | 426/834 [00:00<00:00, 691.77it/s] 61%|██████▏   | 511/834 [00:00<00:00, 739.40it/s] 71%|███████   | 588/834 [00:00<00:00, 743.17it/s] 80%|███████▉  | 664/834 [00:01<00:00, 736.96it/s] 89%|████████▊ | 739/834 [00:01<00:00, 586.04it/s] 97%|█████████▋| 810/834 [00:01<00:00, 617.07it/s]100%|██████████| 834/834 [00:01<00:00, 596.97it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/834 [00:00<?, ?it/s]  7%|▋         | 62/834 [00:00<00:01, 616.63it/s] 24%|██▍       | 202/834 [00:00<00:00, 1073.45it/s] 38%|███▊      | 314/834 [00:00<00:00, 1090.28it/s] 51%|█████     | 424/834 [00:00<00:00, 793.12it/s]  75%|███████▍  | 625/834 [00:00<00:00, 1143.90it/s] 90%|█████████ | 754/834 [00:00<00:00, 1175.80it/s]100%|██████████| 834/834 [00:00<00:00, 1178.22it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
train&val folder:5; test sets:3
audio dimension: 1024; text dimension: 5120; video dimension: 768
====== Training and Evaluation =======
>>>>> Cross-validation: training on the 1 folder >>>>>
Step1: build model (each folder has its own model)
/root/miniconda3/lib/python3.8/site-packages/torch/optim/lr_scheduler.py:60: UserWarning: The verbose parameter is deprecated. Please use get_last_lr() to access the learning rate.
  warnings.warn(
Step2: training (multiple epoches)
epoch:1; metric:emoval; train:-0.0971; eval:0.3774; lr:0.000500
epoch:2; metric:emoval; train:0.3003; eval:0.3228; lr:0.000500
epoch:3; metric:emoval; train:0.4169; eval:0.5309; lr:0.000500
epoch:4; metric:emoval; train:0.4925; eval:0.5546; lr:0.000500
epoch:5; metric:emoval; train:0.5486; eval:0.5450; lr:0.000500
epoch:6; metric:emoval; train:0.5975; eval:0.5055; lr:0.000500
epoch:7; metric:emoval; train:0.6340; eval:0.5525; lr:0.000500
epoch:8; metric:emoval; train:0.6734; eval:0.5469; lr:0.000500
epoch:9; metric:emoval; train:0.6738; eval:0.5864; lr:0.000500
epoch:10; metric:emoval; train:0.6908; eval:0.5829; lr:0.000500
epoch:11; metric:emoval; train:0.7081; eval:0.5767; lr:0.000500
epoch:12; metric:emoval; train:0.7128; eval:0.5830; lr:0.000500
epoch:13; metric:emoval; train:0.7259; eval:0.5685; lr:0.000500
epoch:14; metric:emoval; train:0.7475; eval:0.6077; lr:0.000500
epoch:15; metric:emoval; train:0.7446; eval:0.5818; lr:0.000500
epoch:16; metric:emoval; train:0.7534; eval:0.6010; lr:0.000500
epoch:17; metric:emoval; train:0.7603; eval:0.5240; lr:0.000500
epoch:18; metric:emoval; train:0.7655; eval:0.6002; lr:0.000500
epoch:19; metric:emoval; train:0.7553; eval:0.5893; lr:0.000500
epoch:20; metric:emoval; train:0.7689; eval:0.5622; lr:0.000500
epoch:21; metric:emoval; train:0.7788; eval:0.5744; lr:0.000500
epoch:22; metric:emoval; train:0.7820; eval:0.5608; lr:0.000500
epoch:23; metric:emoval; train:0.7830; eval:0.5710; lr:0.000500
epoch:24; metric:emoval; train:0.7654; eval:0.5821; lr:0.000500
epoch:25; metric:emoval; train:0.7695; eval:0.5631; lr:0.000250
epoch:26; metric:emoval; train:0.8186; eval:0.5548; lr:0.000250
epoch:27; metric:emoval; train:0.7961; eval:0.6046; lr:0.000250
epoch:28; metric:emoval; train:0.8188; eval:0.5973; lr:0.000250
epoch:29; metric:emoval; train:0.8184; eval:0.6139; lr:0.000250
epoch:30; metric:emoval; train:0.8033; eval:0.5646; lr:0.000250
epoch:31; metric:emoval; train:0.8146; eval:0.5980; lr:0.000250
