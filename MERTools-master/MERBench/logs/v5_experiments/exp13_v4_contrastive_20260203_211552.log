====== Params Pre-analysis =======
args:  Namespace(audio_feature='chinese-hubert-large-UTT', batch_size=32, contrastive_temperature=0.07, contrastive_weight=0.1, cross_kl_weight=0.01, dataset='MER2023', debug=False, dropout=0.35, e2e_dim=None, e2e_name=None, early_stopping_patience=30, epochs=100, feat_scale=1, feat_type='utt', focal_gamma=2.0, fusion_temperature=1.0, gate_alpha=0.5, gpu=0, grad_clip=1.0, hidden_dim=128, hyper_path=None, kl_warmup_epochs=20, kl_weight=0.01, l2=5e-05, label_smoothing=0.1, lr=0.0005, lr_adjust='case1', lr_factor=0.5, lr_patience=10, mixup_alpha=0.4, modality_dropout=0.15, modality_dropout_warmup=20, model='attention_robust_v4', n_classes=None, num_attention_heads=4, num_workers=0, print_iters=100000000.0, recon_weight=0.1, save_iters=100000000.0, save_root='./saved-trimodal', savemodel=False, test_dataset=None, text_feature='Baichuan-13B-Base-UTT', train_dataset=None, use_contrastive=True, use_dynamic_kl=True, use_gated_fusion=False, use_mixup=False, use_modality_dropout=True, use_proxy_attention=True, use_vae=True, video_feature='clip-vit-large-patch14-UTT')
====== Reading Data =======
train: sample number 3373
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/3373 [00:00<?, ?it/s]  1%|          | 38/3373 [00:00<00:08, 378.63it/s]  3%|▎         | 90/3373 [00:00<00:07, 460.57it/s]  5%|▍         | 158/3373 [00:00<00:05, 559.31it/s]  7%|▋         | 247/3373 [00:00<00:04, 688.20it/s]  9%|▉         | 316/3373 [00:00<00:04, 678.21it/s] 11%|█▏        | 384/3373 [00:00<00:05, 510.55it/s] 13%|█▎        | 441/3373 [00:00<00:07, 416.31it/s] 15%|█▌        | 508/3373 [00:01<00:06, 474.76it/s] 18%|█▊        | 612/3373 [00:01<00:04, 613.91it/s] 20%|██        | 682/3373 [00:01<00:04, 630.19it/s] 23%|██▎       | 771/3373 [00:01<00:03, 700.21it/s] 25%|██▌       | 846/3373 [00:01<00:03, 712.72it/s] 27%|██▋       | 921/3373 [00:01<00:03, 722.64it/s] 30%|██▉       | 996/3373 [00:01<00:03, 730.45it/s] 32%|███▏      | 1071/3373 [00:01<00:03, 584.28it/s] 35%|███▌      | 1183/3373 [00:01<00:03, 714.56it/s] 38%|███▊      | 1269/3373 [00:02<00:02, 751.28it/s] 41%|████      | 1367/3373 [00:02<00:02, 812.96it/s] 43%|████▎     | 1465/3373 [00:02<00:02, 857.21it/s] 46%|████▌     | 1554/3373 [00:02<00:02, 862.15it/s] 49%|████▊     | 1643/3373 [00:02<00:02, 666.35it/s] 51%|█████     | 1718/3373 [00:02<00:02, 680.00it/s] 53%|█████▎    | 1802/3373 [00:02<00:02, 593.41it/s] 56%|█████▌    | 1891/3373 [00:02<00:02, 660.94it/s] 58%|█████▊    | 1964/3373 [00:02<00:02, 677.70it/s] 60%|██████    | 2037/3373 [00:03<00:02, 549.07it/s] 65%|██████▍   | 2180/3373 [00:03<00:01, 749.88it/s] 67%|██████▋   | 2267/3373 [00:03<00:01, 772.41it/s] 70%|██████▉   | 2353/3373 [00:03<00:01, 792.06it/s] 72%|███████▏  | 2439/3373 [00:03<00:01, 641.74it/s] 77%|███████▋  | 2584/3373 [00:03<00:00, 824.98it/s] 80%|████████  | 2708/3373 [00:03<00:00, 927.57it/s] 83%|████████▎ | 2811/3373 [00:04<00:00, 946.49it/s] 86%|████████▋ | 2913/3373 [00:04<00:00, 773.75it/s] 89%|████████▉ | 3001/3373 [00:04<00:00, 787.92it/s] 92%|█████████▏| 3091/3373 [00:04<00:00, 815.11it/s] 94%|█████████▍| 3179/3373 [00:04<00:00, 828.19it/s] 97%|█████████▋| 3275/3373 [00:04<00:00, 863.78it/s]100%|█████████▉| 3365/3373 [00:04<00:00, 694.62it/s]100%|██████████| 3373/3373 [00:04<00:00, 702.60it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/3373 [00:00<?, ?it/s]  0%|          | 6/3373 [00:00<00:58, 57.89it/s]  1%|          | 32/3373 [00:00<00:19, 174.45it/s]  2%|▏         | 58/3373 [00:00<00:15, 212.27it/s]  3%|▎         | 95/3373 [00:00<00:16, 197.52it/s]  4%|▍         | 143/3373 [00:00<00:11, 274.96it/s]  7%|▋         | 236/3373 [00:00<00:06, 461.85it/s]  9%|▊         | 287/3373 [00:01<00:12, 256.81it/s] 10%|▉         | 326/3373 [00:01<00:10, 280.06it/s] 11%|█         | 365/3373 [00:01<00:09, 301.59it/s] 12%|█▏        | 404/3373 [00:01<00:09, 321.37it/s] 14%|█▍        | 470/3373 [00:01<00:08, 325.11it/s] 15%|█▌        | 507/3373 [00:02<00:14, 201.90it/s] 16%|█▌        | 536/3373 [00:02<00:19, 147.32it/s] 17%|█▋        | 559/3373 [00:02<00:22, 124.87it/s] 17%|█▋        | 584/3373 [00:02<00:19, 140.74it/s] 18%|█▊        | 611/3373 [00:03<00:19, 138.22it/s] 19%|█▊        | 629/3373 [00:03<00:24, 110.41it/s] 19%|█▉        | 650/3373 [00:03<00:21, 125.03it/s] 20%|█▉        | 667/3373 [00:03<00:34, 77.65it/s]  21%|██        | 694/3373 [00:04<00:29, 91.60it/s] 22%|██▏       | 744/3373 [00:04<00:17, 148.07it/s] 24%|██▎       | 799/3373 [00:04<00:12, 214.40it/s] 25%|██▍       | 832/3373 [00:04<00:14, 172.40it/s] 26%|██▌       | 877/3373 [00:04<00:13, 186.74it/s] 28%|██▊       | 961/3373 [00:04<00:08, 294.01it/s] 30%|██▉       | 1003/3373 [00:05<00:08, 270.56it/s] 31%|███       | 1039/3373 [00:05<00:08, 286.65it/s] 32%|███▏      | 1094/3373 [00:05<00:06, 341.47it/s] 34%|███▍      | 1154/3373 [00:05<00:06, 325.56it/s] 35%|███▌      | 1193/3373 [00:05<00:06, 337.12it/s] 36%|███▋      | 1231/3373 [00:05<00:07, 281.05it/s] 37%|███▋      | 1264/3373 [00:06<00:08, 242.60it/s] 40%|███▉      | 1333/3373 [00:06<00:06, 332.41it/s] 41%|████      | 1373/3373 [00:06<00:05, 344.51it/s] 42%|████▏     | 1413/3373 [00:06<00:06, 290.49it/s] 43%|████▎     | 1460/3373 [00:06<00:05, 328.93it/s] 44%|████▍     | 1499/3373 [00:06<00:05, 343.25it/s] 46%|████▌     | 1538/3373 [00:06<00:07, 234.85it/s] 47%|████▋     | 1569/3373 [00:07<00:07, 249.09it/s] 48%|████▊     | 1607/3373 [00:07<00:07, 229.77it/s] 48%|████▊     | 1635/3373 [00:07<00:08, 197.34it/s] 52%|█████▏    | 1746/3373 [00:07<00:04, 373.33it/s] 53%|█████▎    | 1796/3373 [00:07<00:06, 245.24it/s] 54%|█████▍    | 1835/3373 [00:08<00:05, 267.27it/s] 56%|█████▌    | 1876/3373 [00:08<00:05, 293.22it/s] 57%|█████▋    | 1916/3373 [00:08<00:05, 264.12it/s] 58%|█████▊    | 1950/3373 [00:08<00:05, 274.56it/s] 59%|█████▉    | 1983/3373 [00:08<00:08, 173.35it/s] 61%|██████▏   | 2073/3373 [00:09<00:05, 251.86it/s] 62%|██████▏   | 2105/3373 [00:09<00:05, 225.75it/s] 63%|██████▎   | 2133/3373 [00:09<00:05, 232.27it/s] 65%|██████▌   | 2199/3373 [00:09<00:03, 314.41it/s] 66%|██████▋   | 2238/3373 [00:09<00:04, 274.25it/s] 69%|██████▉   | 2330/3373 [00:09<00:02, 405.39it/s] 71%|███████   | 2381/3373 [00:09<00:02, 425.79it/s] 72%|███████▏  | 2432/3373 [00:10<00:02, 359.72it/s] 74%|███████▎  | 2487/3373 [00:10<00:03, 279.26it/s] 75%|███████▌  | 2541/3373 [00:10<00:02, 324.41it/s] 77%|███████▋  | 2582/3373 [00:10<00:02, 340.21it/s] 78%|███████▊  | 2623/3373 [00:10<00:03, 214.96it/s] 79%|███████▉  | 2661/3373 [00:11<00:02, 240.17it/s] 80%|████████  | 2710/3373 [00:11<00:02, 285.45it/s] 82%|████████▏ | 2782/3373 [00:11<00:01, 314.58it/s] 84%|████████▎ | 2820/3373 [00:11<00:02, 274.63it/s] 85%|████████▌ | 2871/3373 [00:11<00:01, 319.96it/s] 86%|████████▋ | 2917/3373 [00:11<00:01, 347.27it/s] 88%|████████▊ | 2957/3373 [00:12<00:01, 246.59it/s] 90%|████████▉ | 3023/3373 [00:12<00:01, 322.77it/s] 92%|█████████▏| 3120/3373 [00:12<00:00, 322.36it/s] 97%|█████████▋| 3263/3373 [00:12<00:00, 514.11it/s] 99%|█████████▉| 3333/3373 [00:12<00:00, 346.85it/s]100%|██████████| 3373/3373 [00:13<00:00, 257.45it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/3373 [00:00<?, ?it/s]  1%|▏         | 47/3373 [00:00<00:07, 469.68it/s]  6%|▌         | 204/3373 [00:00<00:02, 1090.44it/s]  9%|▉         | 313/3373 [00:00<00:03, 768.38it/s]  13%|█▎        | 432/3373 [00:00<00:03, 897.17it/s] 17%|█▋        | 571/3373 [00:00<00:02, 1048.25it/s] 20%|██        | 684/3373 [00:00<00:02, 1058.25it/s] 24%|██▎       | 795/3373 [00:00<00:03, 827.39it/s]  26%|██▋       | 888/3373 [00:01<00:03, 678.03it/s] 29%|██▉       | 982/3373 [00:01<00:03, 732.28it/s] 32%|███▏      | 1074/3373 [00:01<00:02, 775.96it/s] 34%|███▍      | 1160/3373 [00:01<00:03, 645.65it/s] 37%|███▋      | 1233/3373 [00:01<00:03, 664.09it/s] 40%|███▉      | 1349/3373 [00:01<00:02, 773.05it/s] 43%|████▎     | 1434/3373 [00:01<00:02, 792.39it/s] 45%|████▌     | 1529/3373 [00:01<00:02, 824.71it/s] 48%|████▊     | 1616/3373 [00:02<00:03, 548.72it/s] 52%|█████▏    | 1761/3373 [00:02<00:02, 732.75it/s] 55%|█████▌    | 1869/3373 [00:02<00:01, 810.23it/s] 59%|█████▉    | 1999/3373 [00:02<00:01, 928.55it/s] 62%|██████▏   | 2106/3373 [00:02<00:01, 964.95it/s] 66%|██████▌   | 2213/3373 [00:02<00:01, 788.37it/s] 70%|██████▉   | 2361/3373 [00:02<00:01, 949.16it/s] 76%|███████▌  | 2561/3373 [00:03<00:00, 1210.40it/s] 84%|████████▍ | 2827/3373 [00:03<00:00, 1582.66it/s] 89%|████████▉ | 3000/3373 [00:03<00:00, 1611.37it/s] 95%|█████████▍| 3191/3373 [00:03<00:00, 1693.26it/s]100%|██████████| 3373/3373 [00:03<00:00, 989.97it/s] 
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
test1: sample number 411
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/411 [00:00<?, ?it/s]  0%|          | 1/411 [00:00<01:55,  3.56it/s] 32%|███▏      | 130/411 [00:00<00:00, 437.32it/s] 99%|█████████▉| 407/411 [00:00<00:00, 1190.45it/s]100%|██████████| 411/411 [00:00<00:00, 851.68it/s] 
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/411 [00:00<?, ?it/s] 12%|█▏        | 50/411 [00:00<00:00, 498.32it/s] 24%|██▍       | 100/411 [00:00<00:00, 316.11it/s] 63%|██████▎   | 259/411 [00:00<00:00, 752.31it/s] 90%|████████▉ | 369/411 [00:00<00:00, 865.47it/s]100%|██████████| 411/411 [00:00<00:00, 804.35it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/411 [00:00<?, ?it/s] 37%|███▋      | 153/411 [00:00<00:00, 777.10it/s] 74%|███████▍  | 306/411 [00:00<00:00, 1093.47it/s]100%|██████████| 411/411 [00:00<00:00, 1055.25it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
test2: sample number 412
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/412 [00:00<?, ?it/s]  1%|          | 5/412 [00:00<00:08, 49.70it/s] 27%|██▋       | 112/412 [00:00<00:00, 646.57it/s] 63%|██████▎   | 260/412 [00:00<00:00, 1020.40it/s] 99%|█████████▉| 407/412 [00:00<00:00, 1196.73it/s]100%|██████████| 412/412 [00:00<00:00, 1022.07it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/412 [00:00<?, ?it/s]  6%|▋         | 26/412 [00:00<00:01, 258.76it/s] 19%|█▉        | 79/412 [00:00<00:00, 416.46it/s] 44%|████▎     | 180/412 [00:00<00:00, 685.14it/s] 60%|██████    | 249/412 [00:00<00:00, 501.40it/s] 89%|████████▉ | 366/412 [00:00<00:00, 695.88it/s]100%|██████████| 412/412 [00:00<00:00, 685.24it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/412 [00:00<?, ?it/s] 13%|█▎        | 54/412 [00:00<00:00, 535.71it/s] 53%|█████▎    | 220/412 [00:00<00:00, 1194.23it/s]100%|██████████| 412/412 [00:00<00:00, 1375.98it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
test3: sample number 834
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/834 [00:00<?, ?it/s]  1%|          | 6/834 [00:00<00:13, 59.99it/s]  1%|▏         | 12/834 [00:00<00:13, 59.23it/s]  7%|▋         | 59/834 [00:00<00:04, 169.42it/s] 15%|█▍        | 124/834 [00:00<00:02, 246.57it/s] 26%|██▋       | 220/834 [00:00<00:01, 425.24it/s] 32%|███▏      | 269/834 [00:00<00:01, 291.16it/s] 41%|████      | 341/834 [00:01<00:01, 376.75it/s] 47%|████▋     | 390/834 [00:01<00:01, 401.57it/s] 53%|█████▎    | 439/834 [00:01<00:00, 421.99it/s] 61%|██████▏   | 511/834 [00:01<00:00, 496.80it/s] 68%|██████▊   | 567/834 [00:01<00:01, 249.21it/s] 76%|███████▌  | 634/834 [00:02<00:00, 271.30it/s] 87%|████████▋ | 726/834 [00:02<00:00, 285.40it/s] 91%|█████████▏| 763/834 [00:02<00:00, 293.95it/s]100%|██████████| 834/834 [00:02<00:00, 320.83it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/834 [00:00<?, ?it/s]  2%|▏         | 18/834 [00:00<00:04, 179.84it/s] 12%|█▏        | 100/834 [00:00<00:01, 553.25it/s] 19%|█▊        | 156/834 [00:00<00:02, 290.44it/s] 25%|██▍       | 207/834 [00:00<00:02, 278.06it/s] 34%|███▍      | 283/834 [00:00<00:01, 315.28it/s] 48%|████▊     | 398/834 [00:00<00:00, 488.13it/s] 55%|█████▌    | 461/834 [00:01<00:00, 421.12it/s] 62%|██████▏   | 519/834 [00:01<00:00, 319.40it/s] 78%|███████▊  | 653/834 [00:01<00:00, 496.40it/s] 90%|█████████ | 754/834 [00:01<00:00, 598.26it/s]100%|██████████| 834/834 [00:01<00:00, 640.03it/s]100%|██████████| 834/834 [00:01<00:00, 461.30it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/834 [00:00<?, ?it/s]  0%|          | 1/834 [00:00<01:24,  9.84it/s] 22%|██▏       | 184/834 [00:00<00:00, 1066.21it/s] 35%|███▍      | 291/834 [00:00<00:01, 380.60it/s]  45%|████▍     | 372/834 [00:00<00:01, 391.21it/s] 52%|█████▏    | 430/834 [00:01<00:01, 358.43it/s] 61%|██████▏   | 511/834 [00:01<00:00, 372.28it/s] 73%|███████▎  | 612/834 [00:01<00:00, 486.94it/s] 81%|████████▏ | 679/834 [00:01<00:00, 520.78it/s] 89%|████████▉ | 743/834 [00:01<00:00, 449.49it/s]100%|██████████| 834/834 [00:01<00:00, 488.65it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
train&val folder:5; test sets:3
audio dimension: 1024; text dimension: 5120; video dimension: 768
====== Training and Evaluation =======
>>>>> Cross-validation: training on the 1 folder >>>>>
Step1: build model (each folder has its own model)
/root/miniconda3/lib/python3.8/site-packages/torch/optim/lr_scheduler.py:60: UserWarning: The verbose parameter is deprecated. Please use get_last_lr() to access the learning rate.
  warnings.warn(
Step2: training (multiple epoches)
epoch:1; metric:emoval; train:-0.0596; eval:0.2195; lr:0.000500
epoch:2; metric:emoval; train:0.2999; eval:0.3848; lr:0.000500
epoch:3; metric:emoval; train:0.4185; eval:0.4154; lr:0.000500
epoch:4; metric:emoval; train:0.5003; eval:0.4323; lr:0.000500
epoch:5; metric:emoval; train:0.5438; eval:0.4839; lr:0.000500
epoch:6; metric:emoval; train:0.5721; eval:0.4953; lr:0.000500
epoch:7; metric:emoval; train:0.6097; eval:0.4462; lr:0.000500
epoch:8; metric:emoval; train:0.6471; eval:0.5394; lr:0.000500
epoch:9; metric:emoval; train:0.6601; eval:0.4955; lr:0.000500
epoch:10; metric:emoval; train:0.6871; eval:0.4442; lr:0.000500
epoch:11; metric:emoval; train:0.7170; eval:0.4938; lr:0.000500
epoch:12; metric:emoval; train:0.7039; eval:0.5174; lr:0.000500
epoch:13; metric:emoval; train:0.7313; eval:0.5423; lr:0.000500
epoch:14; metric:emoval; train:0.7446; eval:0.5433; lr:0.000500
epoch:15; metric:emoval; train:0.7486; eval:0.5341; lr:0.000500
epoch:16; metric:emoval; train:0.7438; eval:0.5526; lr:0.000500
epoch:17; metric:emoval; train:0.7445; eval:0.4747; lr:0.000500
epoch:18; metric:emoval; train:0.7539; eval:0.5250; lr:0.000500
epoch:19; metric:emoval; train:0.7502; eval:0.5246; lr:0.000500
epoch:20; metric:emoval; train:0.7674; eval:0.5386; lr:0.000500
epoch:21; metric:emoval; train:0.7821; eval:0.5149; lr:0.000500
epoch:22; metric:emoval; train:0.7810; eval:0.4539; lr:0.000500
epoch:23; metric:emoval; train:0.7648; eval:0.3898; lr:0.000500
epoch:24; metric:emoval; train:0.7626; eval:0.5056; lr:0.000500
epoch:25; metric:emoval; train:0.7790; eval:0.5399; lr:0.000500
epoch:26; metric:emoval; train:0.7685; eval:0.5254; lr:0.000500
epoch:27; metric:emoval; train:0.7478; eval:0.5063; lr:0.000250
epoch:28; metric:emoval; train:0.7883; eval:0.5331; lr:0.000250
epoch:29; metric:emoval; train:0.8228; eval:0.5473; lr:0.000250
