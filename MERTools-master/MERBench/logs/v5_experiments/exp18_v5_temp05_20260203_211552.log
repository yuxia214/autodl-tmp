====== Params Pre-analysis =======
args:  Namespace(audio_feature='chinese-hubert-large-UTT', batch_size=32, contrastive_temperature=0.07, contrastive_weight=0.1, cross_kl_weight=0.01, dataset='MER2023', debug=False, dropout=0.35, e2e_dim=None, e2e_name=None, early_stopping_patience=30, epochs=100, feat_scale=1, feat_type='utt', focal_gamma=2.0, fusion_temperature=0.5, gate_alpha=0.5, gpu=0, grad_clip=1.0, hidden_dim=128, hyper_path=None, kl_warmup_epochs=20, kl_weight=0.01, l2=5e-05, label_smoothing=0.1, lr=0.0005, lr_adjust='case1', lr_factor=0.5, lr_patience=10, mixup_alpha=0.4, modality_dropout=0.15, modality_dropout_warmup=20, model='attention_robust_v5', n_classes=None, num_attention_heads=4, num_workers=0, print_iters=100000000.0, recon_weight=0.1, save_iters=100000000.0, save_root='./saved-trimodal', savemodel=False, test_dataset=None, text_feature='Baichuan-13B-Base-UTT', train_dataset=None, use_contrastive=True, use_dynamic_kl=True, use_gated_fusion=True, use_mixup=False, use_modality_dropout=True, use_proxy_attention=True, use_vae=True, video_feature='clip-vit-large-patch14-UTT')
====== Reading Data =======
train: sample number 3373
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/3373 [00:00<?, ?it/s]  2%|▏         | 81/3373 [00:00<00:11, 280.67it/s]  4%|▍         | 149/3373 [00:00<00:07, 410.25it/s]  6%|▌         | 200/3373 [00:00<00:07, 429.66it/s]  9%|▉         | 300/3373 [00:00<00:05, 604.20it/s] 11%|█         | 369/3373 [00:00<00:06, 487.85it/s] 14%|█▍        | 470/3373 [00:00<00:04, 619.37it/s] 17%|█▋        | 582/3373 [00:00<00:03, 751.81it/s] 20%|█▉        | 667/3373 [00:01<00:03, 776.70it/s] 23%|██▎       | 766/3373 [00:01<00:03, 834.28it/s] 25%|██▌       | 855/3373 [00:01<00:02, 849.64it/s] 28%|██▊       | 944/3373 [00:01<00:02, 856.68it/s] 31%|███       | 1033/3373 [00:01<00:05, 404.36it/s] 33%|███▎      | 1101/3373 [00:02<00:06, 340.23it/s] 34%|███▍      | 1155/3373 [00:02<00:06, 366.80it/s] 36%|███▌      | 1208/3373 [00:02<00:07, 295.32it/s] 40%|████      | 1362/3373 [00:02<00:04, 488.81it/s] 44%|████▎     | 1472/3373 [00:02<00:03, 599.48it/s] 46%|████▌     | 1557/3373 [00:02<00:02, 648.84it/s] 49%|████▉     | 1660/3373 [00:02<00:02, 734.20it/s] 52%|█████▏    | 1750/3373 [00:03<00:02, 622.55it/s] 54%|█████▍    | 1833/3373 [00:03<00:02, 667.51it/s] 57%|█████▋    | 1912/3373 [00:03<00:02, 567.17it/s] 59%|█████▊    | 1979/3373 [00:03<00:02, 586.10it/s] 62%|██████▏   | 2081/3373 [00:03<00:01, 678.86it/s] 64%|██████▍   | 2157/3373 [00:03<00:02, 474.38it/s] 66%|██████▌   | 2218/3373 [00:04<00:02, 500.18it/s] 69%|██████▉   | 2330/3373 [00:04<00:01, 632.98it/s] 71%|███████▏  | 2406/3373 [00:04<00:01, 656.40it/s] 74%|███████▎  | 2481/3373 [00:04<00:01, 672.68it/s] 76%|███████▌  | 2555/3373 [00:04<00:01, 556.79it/s] 78%|███████▊  | 2619/3373 [00:04<00:01, 575.49it/s] 80%|███████▉  | 2694/3373 [00:04<00:01, 616.87it/s] 82%|████████▏ | 2761/3373 [00:04<00:00, 627.41it/s] 84%|████████▍ | 2833/3373 [00:04<00:00, 650.47it/s] 87%|████████▋ | 2928/3373 [00:05<00:00, 727.30it/s] 90%|████████▉ | 3024/3373 [00:05<00:00, 790.13it/s] 93%|█████████▎| 3129/3373 [00:05<00:00, 691.93it/s] 97%|█████████▋| 3272/3373 [00:05<00:00, 874.18it/s]100%|█████████▉| 3367/3373 [00:05<00:00, 881.26it/s]100%|██████████| 3373/3373 [00:05<00:00, 602.92it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/3373 [00:00<?, ?it/s]  2%|▏         | 51/3373 [00:00<00:06, 509.28it/s]  3%|▎         | 118/3373 [00:00<00:08, 391.98it/s]  5%|▍         | 167/3373 [00:00<00:07, 425.67it/s]  6%|▋         | 216/3373 [00:00<00:07, 442.88it/s]  9%|▉         | 298/3373 [00:00<00:05, 563.25it/s] 11%|█         | 357/3373 [00:00<00:05, 570.13it/s] 12%|█▏        | 416/3373 [00:00<00:06, 445.10it/s] 14%|█▍        | 473/3373 [00:00<00:06, 476.21it/s] 16%|█▌        | 542/3373 [00:01<00:05, 532.75it/s] 18%|█▊        | 600/3373 [00:01<00:06, 422.32it/s] 21%|██        | 693/3373 [00:01<00:06, 443.63it/s] 22%|██▏       | 742/3373 [00:01<00:05, 452.16it/s] 23%|██▎       | 791/3373 [00:01<00:05, 459.74it/s] 25%|██▍       | 840/3373 [00:01<00:05, 461.70it/s] 26%|██▋       | 888/3373 [00:02<00:13, 183.25it/s] 27%|██▋       | 924/3373 [00:02<00:11, 204.27it/s] 28%|██▊       | 960/3373 [00:02<00:10, 226.89it/s] 30%|███       | 1018/3373 [00:02<00:09, 249.57it/s] 31%|███       | 1052/3373 [00:02<00:08, 263.32it/s] 32%|███▏      | 1086/3373 [00:03<00:09, 232.85it/s] 33%|███▎      | 1115/3373 [00:03<00:09, 242.78it/s] 35%|███▍      | 1166/3373 [00:03<00:08, 248.42it/s] 36%|███▋      | 1223/3373 [00:03<00:08, 261.43it/s] 39%|███▉      | 1329/3373 [00:04<00:07, 262.84it/s] 42%|████▏     | 1401/3373 [00:04<00:06, 288.90it/s] 43%|████▎     | 1443/3373 [00:04<00:07, 266.88it/s] 44%|████▍     | 1477/3373 [00:04<00:06, 278.51it/s] 46%|████▌     | 1544/3373 [00:04<00:05, 350.82it/s] 47%|████▋     | 1585/3373 [00:04<00:04, 359.76it/s] 48%|████▊     | 1625/3373 [00:05<00:06, 254.62it/s] 49%|████▉     | 1658/3373 [00:05<00:07, 226.56it/s] 50%|████▉     | 1686/3373 [00:05<00:07, 235.19it/s] 52%|█████▏    | 1769/3373 [00:05<00:04, 355.93it/s] 54%|█████▍    | 1813/3373 [00:05<00:05, 260.35it/s] 55%|█████▍    | 1848/3373 [00:06<00:07, 203.71it/s] 56%|█████▌    | 1877/3373 [00:06<00:06, 214.81it/s] 56%|█████▋    | 1905/3373 [00:06<00:07, 192.91it/s] 58%|█████▊    | 1945/3373 [00:06<00:06, 229.00it/s] 59%|█████▊    | 1974/3373 [00:06<00:05, 241.19it/s] 61%|██████    | 2049/3373 [00:06<00:04, 294.70it/s] 62%|██████▏   | 2081/3373 [00:06<00:04, 296.75it/s] 63%|██████▎   | 2119/3373 [00:07<00:04, 260.09it/s] 64%|██████▍   | 2169/3373 [00:07<00:04, 255.54it/s] 65%|██████▌   | 2208/3373 [00:07<00:04, 282.06it/s] 66%|██████▋   | 2239/3373 [00:07<00:03, 286.37it/s] 68%|██████▊   | 2282/3373 [00:07<00:05, 217.55it/s] 69%|██████▉   | 2334/3373 [00:07<00:03, 274.50it/s] 70%|███████   | 2368/3373 [00:07<00:03, 287.95it/s] 71%|███████   | 2402/3373 [00:08<00:03, 299.48it/s] 72%|███████▏  | 2436/3373 [00:08<00:03, 249.59it/s] 73%|███████▎  | 2465/3373 [00:08<00:03, 255.83it/s] 74%|███████▍  | 2494/3373 [00:08<00:05, 153.93it/s] 76%|███████▌  | 2552/3373 [00:09<00:05, 150.77it/s] 77%|███████▋  | 2592/3373 [00:09<00:04, 184.86it/s] 78%|███████▊  | 2618/3373 [00:09<00:03, 194.74it/s] 79%|███████▉  | 2674/3373 [00:09<00:03, 193.52it/s] 81%|████████▏ | 2745/3373 [00:09<00:02, 278.49it/s] 84%|████████▎ | 2822/3373 [00:09<00:01, 372.09it/s] 85%|████████▌ | 2872/3373 [00:10<00:01, 329.46it/s] 87%|████████▋ | 2918/3373 [00:10<00:01, 296.36it/s] 89%|████████▉ | 3008/3373 [00:10<00:00, 407.55it/s] 91%|█████████ | 3059/3373 [00:10<00:01, 303.88it/s] 94%|█████████▎| 3160/3373 [00:10<00:00, 423.03it/s] 95%|█████████▌| 3217/3373 [00:10<00:00, 380.63it/s] 97%|█████████▋| 3266/3373 [00:11<00:00, 401.64it/s]100%|█████████▉| 3362/3373 [00:11<00:00, 522.50it/s]100%|██████████| 3373/3373 [00:11<00:00, 301.18it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/3373 [00:00<?, ?it/s]  0%|          | 3/3373 [00:00<03:35, 15.63it/s]  5%|▌         | 169/3373 [00:00<00:04, 716.52it/s]  8%|▊         | 268/3373 [00:00<00:08, 383.79it/s] 10%|▉         | 333/3373 [00:01<00:11, 273.21it/s] 16%|█▌        | 528/3373 [00:01<00:05, 524.85it/s] 18%|█▊        | 624/3373 [00:01<00:05, 516.18it/s] 21%|██        | 705/3373 [00:01<00:04, 556.22it/s] 24%|██▍       | 802/3373 [00:01<00:04, 544.04it/s] 27%|██▋       | 894/3373 [00:01<00:04, 516.18it/s] 29%|██▉       | 994/3373 [00:02<00:04, 510.79it/s] 31%|███       | 1053/3373 [00:02<00:04, 525.07it/s] 35%|███▌      | 1190/3373 [00:02<00:03, 694.10it/s] 38%|███▊      | 1271/3373 [00:02<00:02, 714.46it/s] 40%|████      | 1351/3373 [00:02<00:03, 596.48it/s] 42%|████▏     | 1419/3373 [00:02<00:03, 612.16it/s] 44%|████▍     | 1492/3373 [00:02<00:03, 523.55it/s] 47%|████▋     | 1571/3373 [00:02<00:03, 581.33it/s] 49%|████▊     | 1636/3373 [00:03<00:02, 589.30it/s] 51%|█████▏    | 1734/3373 [00:03<00:02, 686.74it/s] 54%|█████▎    | 1808/3373 [00:03<00:02, 558.56it/s] 57%|█████▋    | 1917/3373 [00:03<00:02, 678.07it/s] 61%|██████    | 2059/3373 [00:03<00:01, 697.67it/s] 66%|██████▌   | 2217/3373 [00:03<00:01, 893.29it/s] 69%|██████▊   | 2317/3373 [00:03<00:01, 914.19it/s] 72%|███████▏  | 2417/3373 [00:03<00:01, 927.25it/s] 76%|███████▌  | 2558/3373 [00:04<00:00, 1047.10it/s] 79%|███████▉  | 2668/3373 [00:04<00:00, 851.08it/s]  84%|████████▍ | 2835/3373 [00:04<00:00, 1036.80it/s] 87%|████████▋ | 2950/3373 [00:04<00:00, 854.59it/s]  91%|█████████ | 3071/3373 [00:04<00:00, 931.77it/s] 94%|█████████▍| 3176/3373 [00:04<00:00, 777.83it/s] 97%|█████████▋| 3265/3373 [00:05<00:00, 645.37it/s]100%|██████████| 3373/3373 [00:05<00:00, 649.12it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
test1: sample number 411
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/411 [00:00<?, ?it/s]  1%|▏         | 6/411 [00:00<00:06, 59.83it/s] 17%|█▋        | 69/411 [00:00<00:00, 392.67it/s] 27%|██▋       | 109/411 [00:00<00:00, 391.75it/s] 73%|███████▎  | 299/411 [00:00<00:00, 981.84it/s]100%|██████████| 411/411 [00:00<00:00, 998.59it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/411 [00:00<?, ?it/s]  8%|▊         | 34/411 [00:00<00:01, 339.29it/s] 24%|██▎       | 97/411 [00:00<00:00, 510.01it/s] 53%|█████▎    | 216/411 [00:00<00:00, 582.43it/s] 77%|███████▋  | 317/411 [00:00<00:00, 714.68it/s]100%|██████████| 411/411 [00:00<00:00, 822.19it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/411 [00:00<?, ?it/s]  1%|          | 4/411 [00:00<00:10, 39.96it/s] 24%|██▍       | 100/411 [00:00<00:00, 577.32it/s] 46%|████▌     | 188/411 [00:00<00:00, 696.65it/s] 73%|███████▎  | 301/411 [00:00<00:00, 864.65it/s]100%|██████████| 411/411 [00:00<00:00, 814.19it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
test2: sample number 412
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/412 [00:00<?, ?it/s]  0%|          | 1/412 [00:00<01:18,  5.22it/s] 15%|█▌        | 63/412 [00:00<00:01, 267.06it/s] 54%|█████▎    | 221/412 [00:00<00:00, 763.41it/s] 87%|████████▋ | 360/412 [00:00<00:00, 978.14it/s]100%|██████████| 412/412 [00:00<00:00, 823.86it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/412 [00:00<?, ?it/s]  7%|▋         | 28/412 [00:00<00:01, 278.77it/s] 29%|██▉       | 121/412 [00:00<00:00, 660.48it/s] 46%|████▌     | 188/412 [00:00<00:00, 467.73it/s] 62%|██████▏   | 257/412 [00:00<00:00, 537.14it/s] 83%|████████▎ | 342/412 [00:00<00:00, 620.87it/s]100%|██████████| 412/412 [00:00<00:00, 597.70it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/412 [00:00<?, ?it/s] 13%|█▎        | 53/412 [00:00<00:00, 529.90it/s] 26%|██▌       | 106/412 [00:00<00:00, 508.90it/s] 78%|███████▊  | 322/412 [00:00<00:00, 879.57it/s]100%|██████████| 412/412 [00:00<00:00, 1018.25it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
test3: sample number 834
audio feature root: /root/autodl-tmp/MERTools-master/MERBench/dataset/mer2023-dataset-process/features/chinese-hubert-large-UTT
  0%|          | 0/834 [00:00<?, ?it/s] 16%|█▌        | 135/834 [00:00<00:00, 1332.67it/s] 39%|███▊      | 323/834 [00:00<00:00, 1651.58it/s] 59%|█████▊    | 489/834 [00:00<00:00, 1627.29it/s] 78%|███████▊  | 652/834 [00:00<00:00, 1192.13it/s] 94%|█████████▍| 784/834 [00:00<00:00, 1222.85it/s]100%|██████████| 834/834 [00:00<00:00, 1374.96it/s]
Input feature chinese-hubert-large-UTT ===> dim is (1, 1024)
  0%|          | 0/834 [00:00<?, ?it/s]  2%|▏         | 16/834 [00:00<00:05, 159.83it/s]  9%|▉         | 73/834 [00:00<00:01, 393.11it/s] 15%|█▍        | 123/834 [00:00<00:02, 309.19it/s] 20%|█▉        | 163/834 [00:00<00:02, 329.34it/s] 30%|██▉       | 249/834 [00:00<00:01, 488.28it/s] 36%|███▌      | 302/834 [00:00<00:01, 389.16it/s] 42%|████▏     | 347/834 [00:01<00:01, 269.28it/s] 46%|████▋     | 386/834 [00:01<00:01, 292.18it/s] 54%|█████▍    | 453/834 [00:01<00:01, 373.17it/s] 60%|█████▉    | 499/834 [00:01<00:00, 393.02it/s] 65%|██████▌   | 545/834 [00:01<00:00, 327.53it/s] 70%|███████   | 584/834 [00:01<00:00, 339.16it/s] 75%|███████▍  | 623/834 [00:01<00:00, 240.88it/s] 86%|████████▌ | 716/834 [00:02<00:00, 372.14it/s] 92%|█████████▏| 766/834 [00:02<00:00, 396.13it/s]100%|██████████| 834/834 [00:02<00:00, 362.39it/s]
Input feature Baichuan-13B-Base-UTT ===> dim is (1, 5120)
  0%|          | 0/834 [00:00<?, ?it/s]  2%|▏         | 14/834 [00:00<00:05, 139.43it/s]  6%|▌         | 49/834 [00:00<00:02, 262.51it/s] 14%|█▎        | 113/834 [00:00<00:01, 429.46it/s] 19%|█▊        | 156/834 [00:00<00:01, 419.68it/s] 24%|██▍       | 199/834 [00:00<00:01, 319.44it/s] 37%|███▋      | 305/834 [00:00<00:01, 522.37it/s] 44%|████▎     | 364/834 [00:00<00:01, 421.66it/s] 50%|█████     | 419/834 [00:01<00:00, 451.83it/s] 63%|██████▎   | 526/834 [00:01<00:00, 608.97it/s] 74%|███████▍  | 619/834 [00:01<00:00, 692.56it/s] 83%|████████▎ | 695/834 [00:01<00:00, 563.80it/s] 91%|█████████▏| 762/834 [00:01<00:00, 475.27it/s]100%|██████████| 834/834 [00:01<00:00, 520.79it/s]
Input feature clip-vit-large-patch14-UTT ===> dim is (1, 768)
train&val folder:5; test sets:3
audio dimension: 1024; text dimension: 5120; video dimension: 768
====== Training and Evaluation =======
>>>>> Cross-validation: training on the 1 folder >>>>>
Step1: build model (each folder has its own model)
/root/miniconda3/lib/python3.8/site-packages/torch/optim/lr_scheduler.py:60: UserWarning: The verbose parameter is deprecated. Please use get_last_lr() to access the learning rate.
  warnings.warn(
Step2: training (multiple epoches)
epoch:1; metric:emoval; train:-0.3338; eval:-0.1422; lr:0.000500
epoch:2; metric:emoval; train:0.1380; eval:0.2131; lr:0.000500
epoch:3; metric:emoval; train:0.3781; eval:0.4399; lr:0.000500
epoch:4; metric:emoval; train:0.5279; eval:0.4355; lr:0.000500
epoch:5; metric:emoval; train:0.6038; eval:0.5047; lr:0.000500
epoch:6; metric:emoval; train:0.6584; eval:0.5091; lr:0.000500
epoch:7; metric:emoval; train:0.7177; eval:0.5278; lr:0.000500
epoch:8; metric:emoval; train:0.7345; eval:0.5354; lr:0.000500
epoch:9; metric:emoval; train:0.7639; eval:0.4881; lr:0.000500
epoch:10; metric:emoval; train:0.7447; eval:0.4830; lr:0.000500
epoch:11; metric:emoval; train:0.7961; eval:0.5056; lr:0.000500
epoch:12; metric:emoval; train:0.7991; eval:0.4646; lr:0.000500
epoch:13; metric:emoval; train:0.8077; eval:0.5189; lr:0.000500
epoch:14; metric:emoval; train:0.8361; eval:0.4709; lr:0.000500
epoch:15; metric:emoval; train:0.8543; eval:0.4988; lr:0.000500
epoch:16; metric:emoval; train:0.8849; eval:0.4991; lr:0.000500
epoch:17; metric:emoval; train:0.8493; eval:0.5467; lr:0.000500
epoch:18; metric:emoval; train:0.8672; eval:0.5121; lr:0.000500
epoch:19; metric:emoval; train:0.8830; eval:0.5393; lr:0.000500
epoch:20; metric:emoval; train:0.8899; eval:0.5208; lr:0.000500
epoch:21; metric:emoval; train:0.8852; eval:0.5264; lr:0.000500
epoch:22; metric:emoval; train:0.8860; eval:0.5207; lr:0.000500
epoch:23; metric:emoval; train:0.8953; eval:0.4820; lr:0.000500
epoch:24; metric:emoval; train:0.8430; eval:0.5051; lr:0.000500
epoch:25; metric:emoval; train:0.8637; eval:0.4912; lr:0.000500
epoch:26; metric:emoval; train:0.8788; eval:0.5025; lr:0.000500
epoch:27; metric:emoval; train:0.8830; eval:0.4926; lr:0.000500
epoch:28; metric:emoval; train:0.8727; eval:0.5345; lr:0.000250
epoch:29; metric:emoval; train:0.9194; eval:0.5040; lr:0.000250
epoch:30; metric:emoval; train:0.9141; eval:0.4851; lr:0.000250
