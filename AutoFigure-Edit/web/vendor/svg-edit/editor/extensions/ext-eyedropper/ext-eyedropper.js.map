{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["../../../../src/editor/extensions/ext-eyedropper/ext-eyedropper.js"],"sourcesContent":["/**\n * @file ext-eyedropper.js\n *\n * @license MIT\n *\n * @copyright 2010 Jeff Schiller\n * @copyright 2021 OptimistikSAS\n *\n */\n\nconst name = 'eyedropper'\n\nconst loadExtensionTranslation = async function (svgEditor) {\n  let translationModule\n  const lang = svgEditor.configObj.pref('lang')\n  try {\n    translationModule = await import(`./locale/${lang}.js`)\n  } catch (_error) {\n    console.warn(`Missing translation (${lang}) for ${name} - using 'en'`)\n    translationModule = await import('./locale/en.js')\n  }\n  svgEditor.i18next.addResourceBundle(lang, name, translationModule.default)\n}\n\nexport default {\n  name,\n  async init () {\n    const svgEditor = this\n    const { svgCanvas } = svgEditor\n    await loadExtensionTranslation(svgEditor)\n    const { ChangeElementCommand } = svgCanvas.history\n    // svgdoc = S.svgroot.parentNode.ownerDocument,\n    const addToHistory = (cmd) => { svgCanvas.undoMgr.addCommandToHistory(cmd) }\n    const currentStyle = {}\n    const { $id, $click } = svgCanvas\n\n    // Helper to show what style is currectly picked\n    const helperCursor = document.createElement('div')\n    helperCursor.style.width = '14px'\n    helperCursor.style.height = '14px'\n    helperCursor.style.position = 'absolute'\n    svgEditor.workarea.appendChild(helperCursor)\n\n    const styleHelper = () => {\n      const mode = svgCanvas.getMode()\n\n      if (mode === name) {\n        helperCursor.style.display = 'block'\n\n        const strokeWidthNum = Number(currentStyle.strokeWidth)\n        const borderStyle = currentStyle.strokeDashArray === 'none' || !currentStyle.strokeDashArray ? 'solid' : 'dotted'\n\n        helperCursor.style.background = currentStyle.fillPaint ?? 'transparent'\n        helperCursor.style.opacity = currentStyle.opacity ?? 1\n        helperCursor.style.border = (strokeWidthNum > 0 && currentStyle.strokePaint) ? `2px ${borderStyle} ${currentStyle.strokePaint}` : 'none'\n      }\n    }\n\n    const resetCurrentStyle = () => {\n      const keys = Object.keys(currentStyle)\n\n      keys.forEach(key => delete currentStyle[key])\n    }\n\n    const cancelHandler = () => {\n      if (Object.keys(currentStyle).length > 0) {\n        resetCurrentStyle()\n        styleHelper()\n      } else {\n        svgEditor.leftPanel.clickSelect()\n      }\n    }\n\n    /**\n     *\n     * @param {module:svgcanvas.SvgCanvas#event:ext_selectedChanged|module:svgcanvas.SvgCanvas#event:ext_elementChanged} opts\n     * @returns {void}\n     */\n    const getStyle = (opts) => {\n      let elem = null\n      if (!opts.multiselected && opts.elems[0] &&\n        !['svg', 'g', 'use'].includes(opts.elems[0].nodeName)\n      ) {\n        elem = opts.elems[0]\n        // grab the current style\n        currentStyle.fillPaint = elem.getAttribute('fill') || 'black'\n        currentStyle.fillOpacity = elem.getAttribute('fill-opacity') || 1.0\n        currentStyle.strokePaint = elem.getAttribute('stroke')\n        currentStyle.strokeOpacity = elem.getAttribute('stroke-opacity') || 1.0\n        currentStyle.strokeWidth = elem.getAttribute('stroke-width')\n        currentStyle.strokeDashArray = elem.getAttribute('stroke-dasharray')\n        currentStyle.strokeLinecap = elem.getAttribute('stroke-linecap')\n        currentStyle.strokeLinejoin = elem.getAttribute('stroke-linejoin')\n        currentStyle.opacity = elem.getAttribute('opacity') || 1.0\n      }\n    }\n\n    return {\n      name: svgEditor.i18next.t(`${name}:name`),\n      callback () {\n        // Add the button and its handler(s)\n        const title = `${name}:buttons.0.title`\n        // const key = `${name}:buttons.0.key`\n        const key = 'ctrl+I'\n        const buttonTemplate = `\n        <se-button id=\"tool_eyedropper\" title=\"${title}\" src=\"eye_dropper.svg\" shortcut=${key}></se-button>\n        `\n        svgCanvas.insertChildAtIndex($id('tools_left'), buttonTemplate, 12)\n        $click($id('tool_eyedropper'), () => {\n          if (this.leftPanel.updateLeftPanel('tool_eyedropper')) {\n            svgCanvas.setMode(name)\n          }\n        })\n\n        // enables helper, resets currently picked style if no element selected\n        document.addEventListener('modeChange', e => {\n          if (svgCanvas.getMode() === name) {\n            styleHelper()\n          } else {\n            helperCursor.style.display = 'none'\n          }\n          if (svgCanvas.getSelectedElements().length === 0) {\n            resetCurrentStyle()\n          }\n        })\n\n        // Positions helper\n        svgEditor.workarea.addEventListener('mousemove', (e) => {\n          const x = e.clientX\n          const y = e.clientY\n\n          if (svgCanvas.getMode() === name) {\n            helperCursor.style.top = y + 'px'\n            helperCursor.style.left = x + 12 + 'px'\n            styleHelper()\n          }\n        })\n\n        svgEditor.workarea.addEventListener('mouseleave', e => {\n          helperCursor.style.display = 'none'\n        })\n\n        // Listens to Esc to reset currently picked style / set Select mode\n        document.addEventListener('keydown', e => {\n          if (e.key === 'Escape' && svgCanvas.getMode() === name) {\n            cancelHandler()\n          }\n        })\n      },\n      // if we have selected an element, grab its paint and enable the eye dropper button\n      selectedChanged: getStyle,\n      mouseDown (opts) {\n        const mode = svgCanvas.getMode()\n        if (mode === name) {\n          const e = opts.event\n          const { target } = e\n          if (!['svg', 'g', 'use'].includes(target.nodeName)) {\n            const changes = {}\n\n            // If some style is picked - applies it to the target, if no style - picks it from the target\n            if (Object.keys(currentStyle).length > 0) {\n              const change = function (elem, attrname, newvalue) {\n                changes[attrname] = elem.getAttribute(attrname)\n                elem.setAttribute(attrname, newvalue)\n              }\n\n              if (currentStyle.fillPaint) { change(target, 'fill', currentStyle.fillPaint) }\n              if (currentStyle.fillOpacity) { change(target, 'fill-opacity', currentStyle.fillOpacity) }\n              if (currentStyle.strokePaint) { change(target, 'stroke', currentStyle.strokePaint) }\n              if (currentStyle.strokeOpacity) { change(target, 'stroke-opacity', currentStyle.strokeOpacity) }\n              if (currentStyle.strokeWidth) { change(target, 'stroke-width', currentStyle.strokeWidth) }\n              if (currentStyle.opacity) { change(target, 'opacity', currentStyle.opacity) }\n              if (currentStyle.strokeLinecap) { change(target, 'stroke-linecap', currentStyle.strokeLinecap) }\n              if (currentStyle.strokeLinejoin) { change(target, 'stroke-linejoin', currentStyle.strokeLinejoin) }\n\n              if (currentStyle.strokeDashArray) {\n                change(target, 'stroke-dasharray', currentStyle.strokeDashArray)\n              } else {\n                target.removeAttribute('stroke-dasharray')\n              }\n\n              addToHistory(new ChangeElementCommand(target, changes))\n            } else {\n              getStyle({ elems: [target] })\n            }\n          }\n        }\n      }\n    }\n  }\n}\n"],"file":"ext-eyedropper.js"}