{"version":3,"mappings":"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","names":["i"],"ignoreList":[],"sources":["../../../../src/editor/extensions/ext-polystar/ext-polystar.js"],"sourcesContent":["/**\n * @file ext-polystar.js\n *\n *\n * @copyright 2010 CloudCanvas, Inc. All rights reserved\n * @copyright 2021 Optimistik SAS, Inc. All rights reserved\n * @license MIT\n *\n */\n\nconst name = 'polystar'\n\nconst loadExtensionTranslation = async function (svgEditor) {\n  let translationModule\n  const lang = svgEditor.configObj.pref('lang')\n  try {\n    translationModule = await import(`./locale/${lang}.js`)\n  } catch (_error) {\n    console.warn(`Missing translation (${lang}) for ${name} - using 'en'`)\n    translationModule = await import('./locale/en.js')\n  }\n  svgEditor.i18next.addResourceBundle(lang, name, translationModule.default)\n}\n\nexport default {\n  name,\n  async init () {\n    const svgEditor = this\n    const { svgCanvas } = svgEditor\n    const { ChangeElementCommand } = svgCanvas.history\n    const addToHistory = (cmd) => { svgCanvas.undoMgr.addCommandToHistory(cmd) }\n    const { $id, $click } = svgCanvas\n    let selElems\n    let started\n    let newFO\n    await loadExtensionTranslation(svgEditor)\n\n    /**\n     * @param {boolean} on true=display\n     * @param {string} tool \"star\" or \"polygone\"\n     * @returns {void}\n     */\n    const showPanel = (on, tool) => {\n      if (on) {\n        $id(`${tool}_panel`).style.removeProperty('display')\n      } else {\n        $id(`${tool}_panel`).style.display = 'none'\n      }\n    }\n\n    /**\n     *\n     * @param {string} attr attribute to change\n     * @param {string|Float} val new value\n     * @returns {void}\n     */\n    const setAttr = (attr, val) => {\n      svgCanvas.changeSelectedAttribute(attr, val)\n      svgCanvas.call('changed', selElems)\n    }\n\n    /**\n     * @param {Float} n angle\n     * @return {Float} cotangeante\n     */\n    const cot = (n) => 1 / Math.tan(n)\n\n    /**\n     * @param {Float} n angle\n     * @returns {Float} sec\n     */\n    const sec = (n) => 1 / Math.cos(n)\n\n    return {\n      name: svgEditor.i18next.t(`${name}:name`),\n      // The callback should be used to load the DOM with the appropriate UI items\n      callback () {\n        // Add the button and its handler(s)\n        // Note: the star extension needs to be loaded before the polygon extension\n        const fbtitle = `${name}:title`\n        const titleStar = `${name}:buttons.0.title`\n        const titlePolygon = `${name}:buttons.1.title`\n        const buttonTemplate = `\n            <se-flyingbutton id=\"tools_polygon\" title=\"${fbtitle}\">\n              <se-button id=\"tool_star\" title=\"${titleStar}\" src=\"star.svg\">\n              </se-button>\n              <se-button id=\"tool_polygon\" title=\"${titlePolygon}\" src=\"polygon.svg\">\n              </se-button>\n            </se-flyingbutton>\n          `\n        svgCanvas.insertChildAtIndex($id('tools_left'), buttonTemplate, 10)\n        // handler\n        $click($id('tool_star'), () => {\n          if (this.leftPanel.updateLeftPanel('tool_star')) {\n            svgCanvas.setMode('star')\n            showPanel(true, 'star')\n            showPanel(false, 'polygon')\n          }\n        })\n        $click($id('tool_polygon'), () => {\n          if (this.leftPanel.updateLeftPanel('tool_polygon')) {\n            svgCanvas.setMode('polygon')\n            showPanel(true, 'polygon')\n            showPanel(false, 'star')\n          }\n        })\n        const label0 = `${name}:contextTools.0.label`\n        const title0 = `${name}:contextTools.0.title`\n        const label1 = `${name}:contextTools.1.label`\n        const title1 = `${name}:contextTools.1.title`\n        const label2 = `${name}:contextTools.2.label`\n        const title2 = `${name}:contextTools.2.title`\n        const label3 = `${name}:contextTools.3.label`\n        const title3 = `${name}:contextTools.3.title`\n        // Add the context panel and its handler(s)\n        const panelTemplate = document.createElement('template')\n        panelTemplate.innerHTML = `\n          <div id=\"star_panel\">\n            <se-spin-input id=\"starNumPoints\" label=\"${label0}\" min=1 step=1 value=5 title=\"${title0}\">\n            </se-spin-input>\n            <se-spin-input id=\"RadiusMultiplier\" label=\"${label1}\" min=1 step=2.5 value=3 title=\"${title1}\">\n            </se-spin-input>\n            <se-spin-input id=\"radialShift\" min=0 step=1 value=0 label=\"${label2}\" title=\"${title2}\">\n            </se-spin-input>\n          </div>\n          <div id=\"polygon_panel\">\n            <se-spin-input size=\"3\" id=\"polySides\" min=1 step=1 value=5 label=\"${label3}\" title=\"${title3}\">\n            </se-spin-input>\n          </div>\n        `\n        // add handlers for the panel\n        $id('tools_top').appendChild(panelTemplate.content.cloneNode(true))\n        // don't display the panels on start\n        showPanel(false, 'star')\n        showPanel(false, 'polygon')\n        $id('starNumPoints').addEventListener('change', (event) => {\n          setAttr('point', event.target.value)\n          const orient = 'point'\n          const point = event.target.value\n          let i = selElems.length\n          while (i--) {\n            const elem = selElems[i]\n            if (elem.hasAttribute('r')) {\n              const oldPoint = elem.getAttribute('point')\n              const oldPoints = elem.getAttribute('points')\n              const radialshift = elem.getAttribute('radialshift')\n              let xpos = 0\n              let ypos = 0\n              if (elem.points) {\n                const list = elem.points\n                const len = list.numberOfItems\n                for (let i = 0; i < len; ++i) {\n                  const pt = list.getItem(i)\n                  xpos += parseFloat(pt.x)\n                  ypos += parseFloat(pt.y)\n                }\n                const cx = xpos / len\n                const cy = ypos / len\n                const circumradius = Number(elem.getAttribute('r'))\n                const inradius = circumradius / elem.getAttribute('starRadiusMultiplier')\n\n                let polyPoints = ''\n                for (let s = 0; point >= s; s++) {\n                  let angle = 2.0 * Math.PI * (s / point)\n                  if (orient === 'point') {\n                    angle -= Math.PI / 2\n                  } else if (orient === 'edge') {\n                    angle = angle + Math.PI / point - Math.PI / 2\n                  }\n\n                  let x = circumradius * Math.cos(angle) + cx\n                  let y = circumradius * Math.sin(angle) + cy\n\n                  polyPoints += x + ',' + y + ' '\n\n                  if (!isNaN(inradius)) {\n                    angle = 2.0 * Math.PI * (s / point) + Math.PI / point\n                    if (orient === 'point') {\n                      angle -= Math.PI / 2\n                    } else if (orient === 'edge') {\n                      angle = angle + Math.PI / point - Math.PI / 2\n                    }\n                    angle += radialshift\n\n                    x = inradius * Math.cos(angle) + cx\n                    y = inradius * Math.sin(angle) + cy\n\n                    polyPoints += x + ',' + y + ' '\n                  }\n                }\n                elem.setAttribute('points', polyPoints)\n                addToHistory(new ChangeElementCommand(elem, { point: oldPoint, points: oldPoints }))\n              }\n            }\n          }\n        })\n        $id('RadiusMultiplier').addEventListener('change', (event) => {\n          setAttr('starRadiusMultiplier', event.target.value)\n        })\n        $id('radialShift').addEventListener('change', (event) => {\n          setAttr('radialshift', event.target.value)\n        })\n        $id('polySides').addEventListener('change', (event) => {\n          setAttr('sides', event.target.value)\n          const sides = event.target.value\n          let i = selElems.length\n          while (i--) {\n            const elem = selElems[i]\n            if (elem.hasAttribute('edge')) {\n              const oldSides = elem.getAttribute('sides')\n              const oldPoints = elem.getAttribute('points')\n              let xpos = 0\n              let ypos = 0\n              if (elem.points) {\n                const list = elem.points\n                const len = list.numberOfItems\n                for (let i = 0; i < len; ++i) {\n                  const pt = list.getItem(i)\n                  xpos += parseFloat(pt.x)\n                  ypos += parseFloat(pt.y)\n                }\n                const cx = xpos / len\n                const cy = ypos / len\n                const edg = elem.getAttribute('edge')\n                const inradius = (edg / 2) * cot(Math.PI / sides)\n                const circumradius = inradius * sec(Math.PI / sides)\n                let points = ''\n                for (let s = 0; sides >= s; s++) {\n                  const angle = (2.0 * Math.PI * s) / sides\n                  const x = circumradius * Math.cos(angle) + cx\n                  const y = circumradius * Math.sin(angle) + cy\n                  points += x + ',' + y + ' '\n                }\n                elem.setAttribute('points', points)\n                addToHistory(new ChangeElementCommand(elem, { sides: oldSides, points: oldPoints }))\n              }\n            }\n          }\n        })\n      },\n      mouseDown (opts) {\n        if (svgCanvas.getMode() === 'star') {\n          const fill = svgCanvas.getColor('fill')\n          const stroke = svgCanvas.getColor('stroke')\n          const strokeWidth = svgCanvas.getStrokeWidth()\n          started = true\n          newFO = svgCanvas.addSVGElementsFromJson({\n            element: 'polygon',\n            attr: {\n              cx: opts.start_x,\n              cy: opts.start_y,\n              id: svgCanvas.getNextId(),\n              shape: 'star',\n              point: $id('starNumPoints').value,\n              r: 0,\n              radialshift: $id('radialShift').value,\n              r2: 0,\n              orient: 'point',\n              fill,\n              stroke,\n              'stroke-width': strokeWidth\n            }\n          })\n          return {\n            started: true\n          }\n        }\n        if (svgCanvas.getMode() === 'polygon') {\n          const fill = svgCanvas.getColor('fill')\n          const stroke = svgCanvas.getColor('stroke')\n          const strokeWidth = svgCanvas.getStrokeWidth()\n          started = true\n          newFO = svgCanvas.addSVGElementsFromJson({\n            element: 'polygon',\n            attr: {\n              cx: opts.start_x,\n              cy: opts.start_y,\n              id: svgCanvas.getNextId(),\n              shape: 'regularPoly',\n              sides: $id('polySides').value,\n              orient: 'x',\n              edge: 0,\n              fill,\n              stroke,\n              'stroke-width': strokeWidth\n            }\n          })\n\n          return {\n            started: true\n          }\n        }\n        return undefined\n      },\n      mouseMove (opts) {\n        if (!started) {\n          return undefined\n        }\n        if (svgCanvas.getMode() === 'star') {\n          const cx = Number(newFO.getAttribute('cx'))\n          const cy = Number(newFO.getAttribute('cy'))\n          const point = Number(newFO.getAttribute('point'))\n          const orient = newFO.getAttribute('orient')\n          const fill = newFO.getAttribute('fill')\n          const stroke = newFO.getAttribute('stroke')\n          const strokeWidth = Number(newFO.getAttribute('stroke-width'))\n          const radialshift = Number(newFO.getAttribute('radialshift'))\n\n          let x = opts.mouse_x\n          let y = opts.mouse_y\n\n          const circumradius =\n            Math.sqrt((x - cx) * (x - cx) + (y - cy) * (y - cy)) / 1.5\n          const RadiusMultiplier = document.getElementById('RadiusMultiplier').value\n          const inradius =\n            circumradius / RadiusMultiplier\n          newFO.setAttribute('r', circumradius)\n          newFO.setAttribute('r2', inradius)\n          newFO.setAttribute('starRadiusMultiplier', RadiusMultiplier)\n\n          let polyPoints = ''\n          for (let s = 0; point >= s; s++) {\n            let angle = 2.0 * Math.PI * (s / point)\n            if (orient === 'point') {\n              angle -= Math.PI / 2\n            } else if (orient === 'edge') {\n              angle = angle + Math.PI / point - Math.PI / 2\n            }\n\n            x = circumradius * Math.cos(angle) + cx\n            y = circumradius * Math.sin(angle) + cy\n\n            polyPoints += x + ',' + y + ' '\n\n            if (!isNaN(inradius)) {\n              angle = 2.0 * Math.PI * (s / point) + Math.PI / point\n              if (orient === 'point') {\n                angle -= Math.PI / 2\n              } else if (orient === 'edge') {\n                angle = angle + Math.PI / point - Math.PI / 2\n              }\n              angle += radialshift\n\n              x = inradius * Math.cos(angle) + cx\n              y = inradius * Math.sin(angle) + cy\n\n              polyPoints += x + ',' + y + ' '\n            }\n          }\n          newFO.setAttribute('points', polyPoints)\n          newFO.setAttribute('fill', fill)\n          newFO.setAttribute('stroke', stroke)\n          newFO.setAttribute('stroke-width', strokeWidth)\n          /* const shape = */ newFO.getAttribute('shape')\n\n          return {\n            started: true\n          }\n        }\n        if (svgCanvas.getMode() === 'polygon') {\n          const cx = Number(newFO.getAttribute('cx'))\n          const cy = Number(newFO.getAttribute('cy'))\n          const sides = Number(newFO.getAttribute('sides'))\n          // const orient = newFO.getAttribute('orient');\n          const fill = newFO.getAttribute('fill')\n          const stroke = newFO.getAttribute('stroke')\n          const strokeWidth = Number(newFO.getAttribute('stroke-width'))\n\n          let x = opts.mouse_x\n          let y = opts.mouse_y\n\n          const edg =\n            Math.sqrt((x - cx) * (x - cx) + (y - cy) * (y - cy)) / 1.5\n          newFO.setAttribute('edge', edg)\n\n          const inradius = (edg / 2) * cot(Math.PI / sides)\n          const circumradius = inradius * sec(Math.PI / sides)\n          let points = ''\n          for (let s = 0; sides >= s; s++) {\n            const angle = (2.0 * Math.PI * s) / sides\n            x = circumradius * Math.cos(angle) + cx\n            y = circumradius * Math.sin(angle) + cy\n\n            points += x + ',' + y + ' '\n          }\n\n          // const poly = newFO.createElementNS(NS.SVG, 'polygon');\n          newFO.setAttribute('points', points)\n          newFO.setAttribute('fill', fill)\n          newFO.setAttribute('stroke', stroke)\n          newFO.setAttribute('stroke-width', strokeWidth)\n          return {\n            started: true\n          }\n        }\n        return undefined\n      },\n      mouseUp () {\n        if (svgCanvas.getMode() === 'star') {\n          const r = newFO.getAttribute('r')\n          return {\n            keep: r !== '0',\n            element: newFO\n          }\n        }\n        if (svgCanvas.getMode() === 'polygon') {\n          const edge = newFO.getAttribute('edge')\n          const keep = edge !== '0'\n          // svgCanvas.addToSelection([newFO], true);\n          return {\n            keep,\n            element: newFO\n          }\n        }\n        return undefined\n      },\n      selectedChanged (opts) {\n        // Use this to update the current selected elements\n        selElems = opts.elems\n        let i = selElems.length\n        // Hide panels if nothing is selected\n        if (!i) {\n          showPanel(false, 'star')\n          showPanel(false, 'polygon')\n          return\n        }\n        while (i--) {\n          const elem = selElems[i]\n          if (elem?.getAttribute('shape') === 'star') {\n            if (opts.selectedElement && !opts.multiselected) {\n              $id('starNumPoints').value = elem.getAttribute('point')\n              $id('radialShift').value = elem.getAttribute('radialshift')\n              showPanel(true, 'star')\n            } else {\n              showPanel(false, 'star')\n            }\n          } else if (elem?.getAttribute('shape') === 'regularPoly') {\n            if (opts.selectedElement && !opts.multiselected) {\n              $id('polySides').value = elem.getAttribute('sides')\n              showPanel(true, 'polygon')\n            } else {\n              showPanel(false, 'polygon')\n            }\n          } else {\n            showPanel(false, 'star')\n            showPanel(false, 'polygon')\n          }\n        }\n      }\n    }\n  }\n}\n"],"file":"ext-polystar.js"}