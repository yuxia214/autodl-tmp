{"version":3,"file":"ext-overview_window.js","sources":["../../../../src/editor/extensions/ext-overview_window/ext-overview_window.js"],"sourcesContent":["/**\n * @file ext-overview_window.js\n *\n * @license MIT\n *\n * @copyright 2013 James Sacksteder\n *\n */\nimport { dragmove } from './dragmove/dragmove.js'\n\nexport default {\n  name: 'overview_window',\n  init ({ _$ }) {\n    const svgEditor = this\n    const { $id, $click } = svgEditor.svgCanvas\n    const overviewWindowGlobals = {}\n\n    // Define and insert the base html element.\n    const propsWindowHtml =\n      '<div id=\"overview_window_content_pane\" style=\"width:100%; word-wrap:break-word;  display:inline-block; margin-top:20px;\">' +\n        '<div id=\"overview_window_content\" style=\"position:relative; padding-left:15px; top:0px;\">' +\n          '<div style=\"background-color:#A0A0A0; display:inline-block; overflow:visible;\">' +\n            '<svg id=\"overviewMiniView\" width=\"132\" height=\"100\" x=\"0\" y=\"0\" viewBox=\"0 0 4800 3600\" ' +\n                'xmlns=\"http://www.w3.org/2000/svg\" ' +\n                'xmlns:xlink=\"http://www.w3.org/1999/xlink\">' +\n              '<use x=\"0\" y=\"0\" href=\"#svgroot\"> </use>' +\n            '</svg>' +\n            '<div id=\"overview_window_view_box\" style=\"min-width:50px; min-height:50px; position:absolute; top:30px; left:30px; z-index:5; background-color:rgba(255,0,102,0.3);\">' +\n            '</div>' +\n          '</div>' +\n        '</div>' +\n      '</div>'\n    $id('sidepanel_content').insertAdjacentHTML('beforeend', propsWindowHtml)\n\n    // Define dynamic animation of the view box.\n    const updateViewBox = () => {\n      const { workarea } = svgEditor\n      const portHeight = parseFloat(getComputedStyle(workarea, null).height.replace('px', ''))\n      const portWidth = parseFloat(getComputedStyle(workarea, null).width.replace('px', ''))\n      const portX = workarea.scrollLeft\n      const portY = workarea.scrollTop\n      const windowWidth = parseFloat(getComputedStyle($id('svgcanvas'), null).width.replace('px', ''))\n      const windowHeight = parseFloat(getComputedStyle($id('svgcanvas'), null).height.replace('px', ''))\n      const overviewWidth = parseFloat(getComputedStyle($id('overviewMiniView'), null).width.replace('px', ''))\n      const overviewHeight = parseFloat(getComputedStyle($id('overviewMiniView'), null).height.replace('px', ''))\n\n      const viewBoxX = portX / windowWidth * overviewWidth\n      const viewBoxY = portY / windowHeight * overviewHeight\n      const viewBoxWidth = portWidth / windowWidth * overviewWidth\n      const viewBoxHeight = portHeight / windowHeight * overviewHeight\n\n      $id('overview_window_view_box').style.minWidth = viewBoxWidth + 'px'\n      $id('overview_window_view_box').style.minHeight = viewBoxHeight + 'px'\n      $id('overview_window_view_box').style.top = viewBoxY + 'px'\n      $id('overview_window_view_box').style.left = viewBoxX + 'px'\n    }\n    $id('workarea').addEventListener('scroll', () => {\n      if (!(overviewWindowGlobals.viewBoxDragging)) {\n        updateViewBox()\n      }\n    })\n    $id('workarea').addEventListener('resize', updateViewBox)\n    updateViewBox()\n\n    // Compensate for changes in zoom and canvas size.\n    const updateViewDimensions = function () {\n      const viewWidth = parseFloat(getComputedStyle($id('svgroot'), null).width.replace('px', ''))\n      const viewHeight = parseFloat(getComputedStyle($id('svgroot'), null).height.replace('px', ''))\n\n      const viewX = 640\n      const viewY = 480\n\n      const svgWidthOld = parseFloat(getComputedStyle($id('overviewMiniView'), null).width.replace('px', ''))\n      const svgHeightNew = viewHeight / viewWidth * svgWidthOld\n      $id('overviewMiniView').setAttribute('viewBox', viewX + ' ' + viewY + ' ' + viewWidth + ' ' + viewHeight)\n      $id('overviewMiniView').setAttribute('height', svgHeightNew)\n      updateViewBox()\n    }\n    updateViewDimensions()\n\n    // Set up the overview window as a controller for the view port.\n    overviewWindowGlobals.viewBoxDragging = false\n    const updateViewPortFromViewBox = function () {\n      const windowWidth = parseFloat(getComputedStyle($id('svgcanvas'), null).width.replace('px', ''))\n      const windowHeight = parseFloat(getComputedStyle($id('svgcanvas'), null).height.replace('px', ''))\n      const overviewWidth = parseFloat(getComputedStyle($id('overviewMiniView'), null).width.replace('px', ''))\n      const overviewHeight = parseFloat(getComputedStyle($id('overviewMiniView'), null).height.replace('px', ''))\n      const viewBoxX = parseFloat(getComputedStyle($id('overview_window_view_box'), null).getPropertyValue('left').replace('px', ''))\n      const viewBoxY = parseFloat(getComputedStyle($id('overview_window_view_box'), null).getPropertyValue('top').replace('px', ''))\n\n      const portX = viewBoxX / overviewWidth * windowWidth\n      const portY = viewBoxY / overviewHeight * windowHeight\n      $id('workarea').scrollLeft = portX\n      $id('workarea').scrollTop = portY\n    }\n    const onStart = () => {\n      overviewWindowGlobals.viewBoxDragging = true\n      updateViewPortFromViewBox()\n    }\n    const onEnd = (el, parent, _x, _y) => {\n      if ((el.offsetLeft + el.offsetWidth) > parseFloat(getComputedStyle(parent, null).width.replace('px', ''))) {\n        el.style.left = (parseFloat(getComputedStyle(parent, null).width.replace('px', '')) - el.offsetWidth) + 'px'\n      } else if (el.offsetLeft < 0) {\n        el.style.left = '0px'\n      }\n      if ((el.offsetTop + el.offsetHeight) > parseFloat(getComputedStyle(parent, null).height.replace('px', ''))) {\n        el.style.top = (parseFloat(getComputedStyle(parent, null).height.replace('px', '')) - el.offsetHeight) + 'px'\n      } else if (el.offsetTop < 0) {\n        el.style.top = '0px'\n      }\n      overviewWindowGlobals.viewBoxDragging = false\n      updateViewPortFromViewBox()\n    }\n    const onDrag = function () {\n      updateViewPortFromViewBox()\n    }\n    const dragElem = document.querySelector('#overview_window_view_box')\n    const parentElem = document.querySelector('#overviewMiniView')\n    dragmove(dragElem, dragElem, parentElem, onStart, onEnd, onDrag)\n\n    $click($id('overviewMiniView'), (evt) => {\n      // Firefox doesn't support evt.offsetX and evt.offsetY.\n      const mouseX = (evt.offsetX || evt.originalEvent.layerX)\n      const mouseY = (evt.offsetY || evt.originalEvent.layerY)\n      const overviewWidth = parseFloat(getComputedStyle($id('overviewMiniView'), null).width.replace('px', ''))\n      const overviewHeight = parseFloat(getComputedStyle($id('overviewMiniView'), null).height.replace('px', ''))\n      const viewBoxWidth = parseFloat(getComputedStyle($id('overview_window_view_box'), null).getPropertyValue('min-width').replace('px', ''))\n      const viewBoxHeight = parseFloat(getComputedStyle($id('overview_window_view_box'), null).getPropertyValue('min-height').replace('px', ''))\n\n      let viewBoxX = mouseX - 0.5 * viewBoxWidth\n      let viewBoxY = mouseY - 0.5 * viewBoxHeight\n      // deal with constraints\n      if (viewBoxX < 0) {\n        viewBoxX = 0\n      }\n      if (viewBoxY < 0) {\n        viewBoxY = 0\n      }\n      if (viewBoxX + viewBoxWidth > overviewWidth) {\n        viewBoxX = overviewWidth - viewBoxWidth\n      }\n      if (viewBoxY + viewBoxHeight > overviewHeight) {\n        viewBoxY = overviewHeight - viewBoxHeight\n      }\n      $id('overview_window_view_box').style.top = viewBoxY + 'px'\n      $id('overview_window_view_box').style.left = viewBoxX + 'px'\n      updateViewPortFromViewBox()\n    })\n\n    return {\n      name: 'overview window',\n      canvasUpdated: updateViewDimensions,\n      workareaResized: updateViewBox\n    }\n  }\n}\n"],"names":[],"mappings":"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"}