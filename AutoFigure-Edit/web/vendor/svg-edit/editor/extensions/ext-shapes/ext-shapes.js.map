{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["../../../../src/editor/extensions/ext-shapes/ext-shapes.js"],"sourcesContent":["/**\n * @file ext-shapes.js\n *\n * @license MIT\n *\n * @copyright 2010 Christian Tzurcanu, 2010 Alexis Deveria\n *\n */\nconst name = 'shapes'\n\nconst loadExtensionTranslation = async function (svgEditor) {\n  let translationModule\n  const lang = svgEditor.configObj.pref('lang')\n  try {\n    translationModule = await import(`./locale/${lang}.js`)\n  } catch (_error) {\n    console.warn(`Missing translation (${lang}) for ${name} - using 'en'`)\n    translationModule = await import('./locale/en.js')\n  }\n  svgEditor.i18next.addResourceBundle(lang, name, translationModule.default)\n}\n\nexport default {\n  name,\n  async init () {\n    const svgEditor = this\n    const canv = svgEditor.svgCanvas\n    const { $id, $click } = canv\n    const svgroot = canv.getSvgRoot()\n    let lastBBox = {}\n    await loadExtensionTranslation(svgEditor)\n\n    const modeId = 'shapelib'\n    const startClientPos = {}\n\n    let curShape\n    let startX\n    let startY\n\n    return {\n      callback () {\n        if ($id('tool_shapelib') === null) {\n          const extPath = svgEditor.configObj.curConfig.extPath\n          const buttonTemplate = `\n          <se-explorerbutton id=\"tool_shapelib\" title=\"${svgEditor.i18next.t(`${name}:buttons.0.title`)}\" lib=\"${extPath}/ext-shapes/shapelib/\"\n          src=\"shapelib.svg\"></se-explorerbutton>\n          `\n          canv.insertChildAtIndex($id('tools_left'), buttonTemplate, 9)\n          $click($id('tool_shapelib'), () => {\n            if (this.leftPanel.updateLeftPanel('tool_shapelib')) {\n              canv.setMode(modeId)\n            }\n          })\n        }\n      },\n      mouseDown (opts) {\n        const mode = canv.getMode()\n        if (mode !== modeId) { return undefined }\n\n        const currentD = document.getElementById('tool_shapelib').dataset.draw\n        startX = opts.start_x\n        const x = startX\n        startY = opts.start_y\n        const y = startY\n        const curStyle = canv.getStyle()\n\n        startClientPos.x = opts.event.clientX\n        startClientPos.y = opts.event.clientY\n\n        curShape = canv.addSVGElementsFromJson({\n          element: 'path',\n          curStyles: true,\n          attr: {\n            d: currentD,\n            id: canv.getNextId(),\n            opacity: curStyle.opacity / 2,\n            style: 'pointer-events:none'\n          }\n        })\n\n        curShape.setAttribute('transform', 'translate(' + x + ',' + y + ') scale(0.005) translate(' + -x + ',' + -y + ')')\n\n        canv.recalculateDimensions(curShape)\n\n        lastBBox = curShape.getBBox()\n\n        return {\n          started: true\n        }\n      },\n      mouseMove (opts) {\n        const mode = canv.getMode()\n        if (mode !== modeId) { return }\n\n        const zoom = canv.getZoom()\n        const evt = opts.event\n\n        const x = opts.mouse_x / zoom\n        const y = opts.mouse_y / zoom\n\n        const tlist = curShape.transform.baseVal\n        const box = curShape.getBBox()\n        const left = box.x; const top = box.y\n\n        const newbox = {\n          x: Math.min(startX, x),\n          y: Math.min(startY, y),\n          width: Math.abs(x - startX),\n          height: Math.abs(y - startY)\n        }\n\n        let sx = (newbox.width / lastBBox.width) || 1\n        let sy = (newbox.height / lastBBox.height) || 1\n\n        // Not perfect, but mostly works...\n        let tx = 0\n        if (x < startX) {\n          tx = lastBBox.width\n        }\n        let ty = 0\n        if (y < startY) {\n          ty = lastBBox.height\n        }\n\n        // update the transform list with translate,scale,translate\n        const translateOrigin = svgroot.createSVGTransform()\n        const scale = svgroot.createSVGTransform()\n        const translateBack = svgroot.createSVGTransform()\n\n        translateOrigin.setTranslate(-(left + tx), -(top + ty))\n        if (!evt.shiftKey) {\n          const max = Math.min(Math.abs(sx), Math.abs(sy))\n\n          sx = max * (sx < 0 ? -1 : 1)\n          sy = max * (sy < 0 ? -1 : 1)\n        }\n        scale.setScale(sx, sy)\n\n        translateBack.setTranslate(left + tx, top + ty)\n        tlist.appendItem(translateBack)\n        tlist.appendItem(scale)\n        tlist.appendItem(translateOrigin)\n\n        canv.recalculateDimensions(curShape)\n\n        lastBBox = curShape.getBBox()\n      },\n      mouseUp (opts) {\n        const mode = canv.getMode()\n        if (mode !== modeId) { return undefined }\n\n        const keepObject = (opts.event.clientX !== startClientPos.x && opts.event.clientY !== startClientPos.y)\n\n        return {\n          keep: keepObject,\n          element: curShape,\n          started: false\n        }\n      }\n    }\n  }\n}\n"],"file":"ext-shapes.js"}